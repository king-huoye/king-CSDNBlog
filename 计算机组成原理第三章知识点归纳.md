# 系统总线

## 3.1 总线的基本概念

### 为什么会出现

随着计算机应用领域的不断扩大，I/O设备的种类和数量也越来越多，为了满足随时增添或减撤设备的需要，使用分散连接的方式不太能满足需求。所以出现了总线

### 总线的概念

总线是连接多个部件的信息传输线，是各部件共享的传输介质

### 总线结构

- 单总线结构
- 双总线结构
    - 以CPU为中心
    - 以存储器为中心

## 3.2 总线的分类

### 片内总线

片内总线是指芯片内部的总线

### 系统总线

- 概念

    系统总线是指CPU、主存、I/O设备（通过I/O接口）各大部件之间的信息传输线。

- 数据总线

    数据总线用来传输各功能部件之间的数据信息，它是双向传输总线

- 地址总线

    地址总线主要用来指出数据总线上的源数据或目的数据在主存单元的地址或I/O设备的地址。

- 控制总线

    控制总线是用来发出各种控制信号的传输线

### 通信总线

- 概念

    通信总线用于计算机系统之间或计算机系统与其它系统（如控制仪表、移动通信）之间的通信

- 传输方式
    - 串行通信
    - 并行通信

## 3.3 总线特性及性能指标

### 总线特性

- 机械特性

    机械连接方式上的一些性能

- 电气特性

    总线的每一根传输线上的信号的传递方向和有效的电平范围

- 功能特性

    总线中每根传输线的功能

- 时间特性

    总线中任一根线在什么时间内有效

### 总线的性能指标

- 总线宽度

    数据总线的根数

- 总线带宽

    总线的数据传输速率

- 时钟同步/异步

    与时钟同步工作的总线的总线称为同步总线，与时钟不同步工作的总线称为异步总线

- 总线复用

    一条信号线上分时传送两种信号

- 信号线数

    地址总线、数据总线和控制总线三种总线数的总和。

- 总线控制方式

    包括突发工作、自动配置、仲裁方式、逻辑方式、计数方式等

- 其他指标

    负载能力、电源电压、总线宽度能否扩展

### 总线标准

## 3.4 总线结构

### 单总线结构

### 多总线结构

- 特点

    将速度较低的I/O设备从单总线上分离出来，形成主存总线与I/O总线分开的结构 如果将速率不同的I/O设备进行分类，然后将他们连接着不同的通道上，那么计算机的工作效率将会更高，由此发展成多总线结构。

- 举例
    - 传统微型计算机的总线结构
    - VL0BUS局部总线结构
    - PCI总线结构
    - 多层PCI总线结构

## 3.5 总线控制

### 总线判优控制

- 总线上设备的分类

    按其对总线有无控制功能可分为主设备（模块）和从设备（模块两种）

- 判优控制的分类
    - 集中式

        将控制逻辑集中在一处（如在CPU中）

        - 链式查询

            优点：只需很少几根线就能按一定优先次序实现总线控制，并且很容易扩充设备。 缺点：对电路很敏感，且优先级别低的设备可能很难获得请求。

        - 计时器定时查询

            计数可以从0开始，此时一旦设备的优先次序被固定，设备的优先级就按0，1，2，3。。。的顺序排列，并且固定不变，计数也可以从上一次计数的终止点开始，即是一种循环方法，此时设备使用总线的优先级相等，计数器的初始值还可由程序设置，故优先次序可以改变。 这种方式对电路故障不然链式查询方式敏感，但增加了控制线的（设备地址）数，控制也较为复杂。

        - 独立请求方式

            响应速度快，优先次序控制灵活（通过程序改变） 但控制线数量多，总线控制更复杂

    - 分布式

        将控制逻辑分散在与总线连接的各个部件或设备上

### 总线通信控制

- 总线周期
    - 申请分配周阶段
    - 寻址阶段
    - 传数阶段
    - 结束阶段
- 方法
    - 同步通信

        通信双方由统一时标控制数据传送称为同步通信

    - 异步通信

        没有公共的时钟标准，不要求所有部件严格的同一操作时间，而是采用应答方式（当主模块发出请求信号时，一直等待从模块反馈回来的响应信号才开始通信）

        - 不互锁

            主模块发出请求信号后，不必等待接到从模块的回答信号，确认从模块已收到请求信号后，便撤销其请求信号

        - 半互锁

            主模块发出请求后，必须待接到从模块回答信号后再撤销其请求信号，有互锁关系

        - 全互锁

            主模块发出请求信号，必须待从模块回答后再撤销其请求信号，从模块发出回答信号，必须呆获知主模块请求信号已撤销后，再撤销其回答信号

        - 波特率

            用来衡量异步串行通信的数据传送速率。波特率是指单位时间内传输二进制数据的位数，单位用bps（位/秒）表示，记作波特。

            ps：若只考虑有效数据位，可用比特率来衡量异步串行通信的数据传输速率，即单位时间内传送二进制有效数据的位数，单位也是bps

    - 半同步通信

        同步、异步结合

        既保留了同步通信的基本特点：严格参照系统时钟的某个前沿开始，而接收方都采用系统时钟后沿时刻来进行判断识别

        同时又像异步通信那样：允许不同速度的模块和谐地工作。

    - 分离式通信

        充分挖掘系统总线每个瞬间的潜力

        1. 各模块有权申请占用总线
        2. 采用同步方式通信，不等对方回答
        3. 各模块准备数据时，不占用总线
        4. 总线被占用时，无空闲

        充分提高了总线的有效占用


